---
title: "Testing Final"
author: "UDEP Project, Brigham Young University"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(ggplot2)
library(gridExtra)
library(tidyverse)
library(DescTools)
```

```{r}
# Upload the data here
data <- read.csv(file='~/Library/Mobile Documents/com~apple~CloudDocs/MPA FALL 2020:WINTER 2021/MPA WINTER 2021/TA /UDEP/UDEP Household Survey -FAKE DATA.csv',header=TRUE, stringsAsFactors=FALSE)
# names(data)
# create a vector with all of the questions and their corresponding question numbers
questions <- data[1,]
# get rid of question rows in dataset for analysis
data <- data[-(1:2),]
```

```{r}
# Define some of the Demographic variables (for now make them all binary)
data$Q9b <- ifelse(data$Q9=="Man",0, ifelse(data$Q9=="Woman",1,NA)) # men vs. women
data$Q6b <- ifelse(data$Q6<=40,0, ifelse(data$Q6>40,1,NA)) # 0-40 vs 40+
data$Q133b <- ifelse(data$Q133 %like% "Employed for wages%",1, ifelse(data$Q133 %like% "Out of work%",0,NA)) # Binary measure of employment status (needs to be recoded to ordinal later)
data$Q147b <- ifelse(data$Q147 == "yes",1,0)
# Define some of the Demographic variables 
data$Q25b <- ifelse(data$Q25=="Rural",1, ifelse(data$Q25=="Urban",3,2)) # rural(1) vs. urban (3) vs.Suburban(2)
```


<!-- 7. Affordable and Clean Energy -->

```{r include=FALSE}
data$Q54b <- ifelse(data$Q54 == "National grid connection",1, ifelse(data$Q54 == "Local mini grid connection",2, ifelse(data$Q54 == "Electric generator",3, ifelse(data$Q54 == "Rechargeable battery",4, ifelse(data$Q54 == "Dry-cell battery",5, ifelse(data$Q54 == "Solar latern",6, ifelse(data$Q54 == "Solar multi-light product",7, ifelse(data$Q54 == "Solar home system",8, ifelse(data$Q54 == "Pico-hydro",9, ifelse(data$Q54 == "Other",10,NA))))))))))

data$Q48.1b <- ifelse(data$Q48.1 == "Traditional (such as dung, agricultural residue, and fuelwood)",1, ifelse(data$Q48.1 == "Intermediate (such as charcoal and kerosene)",2, ifelse(data$Q48.1 == "Modern (such as LPG, biogas, ethanol gas, plant oils, dimethyl ether (DME), and electricity)",3, ifelse(data$Q48.1 == "No fuel source for cooking, not needed",4, ifelse(data$Q48.1 == "No fuel source for cooking, but needed",5,NA)))))

data$Q49b <- ifelse(data$Q49 == "Traditional (such as dung, agricultural residue, and fuelwood)",1, ifelse(data$Q49 == "Intermediate (such as charcoal and kerosene)",2, ifelse(data$Q49 == "Modern (such as LPG, biogas, ethanol gas, plant oils, dimethyl ether (DME), and electricity)",3, ifelse(data$Q49 == "No fuel source for heating, not needed",4, ifelse(data$Q49 == "No fuel source for heating, but needed",5,NA)))))

data$Q50.1b <- ifelse(data$Q50.1 == "Traditional (such as dung, agricultural residue, and fuelwood)",1, ifelse(data$Q50.1 == "Intermediate (such as charcoal and kerosene)",2, ifelse(data$Q50.1 == "Modern (such as LPG, biogas, ethanol gas, plant oils, dimethyl ether (DME), and electricity)",3, ifelse(data$Q50.1 == "No fuel source for lighting, not needed",4, ifelse(data$Q50.1 == "No fuel source for lighting, but needed",5,NA)))))

data$Q43b <- ifelse(data$Q43 == "Appliances (includes refrigerator, dishwasher, clothes washer and dryer)",1, ifelse(data$Q43 == "Cooking",2, ifelse(data$Q43 == "Entertainment,electronics (includes external power adapters, TVs, home office equipment, computers, and small appliances)",3, ifelse(data$Q43 == "Heating",4, ifelse(data$Q43 == "Lighting",5,NA)))))

data$Q44.1 <- as.numeric(data$Q44.1)
data$Q45 <- as.numeric(data$Q45)
data$Q46.1 <- as.numeric(data$Q46.1)

# Text to add to body paragraphs with new survey questions (heating, lighting, and cooking all have two additional responses)
# `r round(mean(data$Q48.1b == 4, na.rm = TRUE)*100)`% said no fuel source for cooking (not needed), `r round(mean(data$Q48.1b == 5, na.rm = TRUE)*100)`% said no fuel source for cooking (but needed).
# `r round(mean(data$Q49b == 4, na.rm = TRUE)*100)`% said no fuel source for heating (not needed), `r round(mean(data$Q49b == 5, na.rm = TRUE)*100)`% said no fuel source for heating (but needed).
# `r round(mean(data$Q50.1b == 4, na.rm = TRUE)*100)`% said no fuel source for lighting (not needed), `r round(mean(data$Q50.1b == 5, na.rm = TRUE)*100)`% said no fuel source for lighting (but needed).
```

# 7. Affordable and Clean Energy

Of those who reported having access to electricity `r round(mean(data$Q54b == 1, na.rm = TRUE)*100)`% had access to a national grid connection, `r round(mean(data$Q54b == 2, na.rm = TRUE)*100)`% had access to a local mini grid connection, `r round(mean(data$Q54b == 3, na.rm = TRUE)*100)`% had access to an electric generator, `r round(mean(data$Q54b == 4, na.rm = TRUE)*100)`% had access to a rechargable battery, `r round(mean(data$Q54b == 5, na.rm = TRUE)*100)`% had access to a dry-cell battery, `r round(mean(data$Q54b == 6, na.rm = TRUE)*100)`% had access to a solar lantern, `r round(mean(data$Q54b == 7, na.rm = TRUE)*100)`% had access to a solar multi-light product, `r round(mean(data$Q54b == 8, na.rm = TRUE)*100)`% had a solar home system, and `r round(mean(data$Q54b == 9, na.rm = TRUE)*100)`% had access to pico-hydro electricity.

When asked about primary fuel source for cooking `r round(mean(data$Q48.1b == 1, na.rm = TRUE)*100)`% of participants said traditional (such as dung, agricultural residue, and fuelwood), `r round(mean(data$Q48.1b == 2, na.rm = TRUE)*100)`% said intermediate (such as charcoal and kerosene), and `r round(mean(data$Q48.1b == 3, na.rm = TRUE)*100)`% said modern (such as LPG, Biogas, ethanol gas, plant oils, dimethyl ether (DME), and electricity).

When asked about primary fuel source for heating `r round(mean(data$Q49b == 1, na.rm = TRUE)*100)`% of participants said traditional (such as dung, agricultural residue, and fuelwood), `r round(mean(data$Q49b == 2, na.rm = TRUE)*100)`% said intermediate (such as charcoal and kerosene), and `r round(mean(data$Q49b == 3, na.rm = TRUE)*100)`% said modern (such as LPG, Biogas, ethanol gas, plant oils, dimethyl ether (DME), and electricity).

When asked about primary fuel source lighting `r round(mean(data$Q50.1b == 1, na.rm = TRUE)*100)`% of participants said traditional (such as dung, agricultural residue, and fuelwood), `r round(mean(data$Q50.1b == 2, na.rm = TRUE)*100)`% said intermediate (such as charcoal and kerosene), and `r round(mean(data$Q50.1b == 3, na.rm = TRUE)*100)`% said modern (such as LPG, Biogas, ethanol gas, plant oils, dimethyl ether (DME), and electricity).

```{r message=FALSE, warning=FALSE, fig.height=5,fig.width=8}
plot1 <- data %>%
  filter(!is.na(Q54b)) %>%
ggplot(aes(x = as.factor(Q54b), fill = as.factor(Q54b))) +
  geom_bar(show.legend = FALSE) +
  scale_x_discrete(labels= c("National grid connection","Local mini grid connection","Electric generator", "Rechargeable battery", "Dry-cell battery", "Solar latern", "Solar multi-light product", "Solar home system", "Pico-hydro", "Other")) +
  labs(x= "Source" , y= "Count", title = "Electricity Source") +
  scale_fill_manual(values=c("#999999", "#999999","#999999", "#999999","#999999","#999999","#999999","#999999","#999999","#999999")) +
  coord_flip()

plot2 <- data %>%
  filter(!is.na(Q48.1b)) %>%
ggplot(aes(x = as.factor(Q48.1b), fill = as.factor(Q48.1b))) +
  geom_bar(show.legend = FALSE) +
  scale_x_discrete(labels = c("1" = "Traditional", "2" = "Intermediate", "3" = "Modern")) +
  scale_fill_manual(values = c("#56B4E9", "#56B4E9","#56B4E9")) +
  labs(x = "Source", y= "Count", title= "Cooking Fuel Source")

plot3 <- data %>%
  filter(!is.na(Q49b)) %>%
ggplot(aes(x = as.factor(Q49b), fill = as.factor(Q49b))) +
  geom_bar(show.legend = FALSE) +
  scale_x_discrete(labels = c("1" = "Traditional", "2" = "Intermediate", "3" = "Modern")) +
  scale_fill_manual(values = c("#56B4E9", "#56B4E9","#56B4E9")) +
  labs(x = "Source", y= "Count", title= "Heating Fuel Source")

plot4 <- data %>%
  filter(!is.na(Q50.1b)) %>%
ggplot(aes(x = as.factor(Q50.1b), fill = as.factor(Q50.1b))) +
  geom_bar(show.legend = FALSE) +
  scale_x_discrete(labels = c("1" = "Traditional", "2" = "Intermediate", "3" = "Modern", "4"="Not needed","5"="Needed"  )) +
  scale_fill_manual(values = c("#999999","#999999","#999999","#999999")) +
  labs(x = "Source", y= "Count", title= "Lighting Fuel Source")

grid.arrange(plot1, plot2, plot3, plot4, nrow = 2, ncol=2)
```

Of those who have access to electricity `r round(mean(data$Q43b == 1, na.rm = TRUE)*100)`% use electricity mainly for appliances (includes refrigerator, dishwasher, clothes washer and dryer), `r round(mean(data$Q43b == 2, na.rm = TRUE)*100)`% mainly use it for cooking, `r round(mean(data$Q43b == 3, na.rm = TRUE)*100)`% mainly use it for entertainment and electronics (includes external power adapters, TVs, home office equipment, computers, and small appliances), `r round(mean(data$Q43b == 4, na.rm = TRUE)*100)`% mainly use it for heating, and `r round(mean(data$Q43b == 5, na.rm = TRUE)*100)`% mainly use it for lighting.

On average famalies use electricity `r round(mean(data$Q44.1, na.rm = TRUE))` hours a day. Households also on average lose electricty `r round(mean(data$Q45, na.rm = TRUE))` times a week. The average length of a power outage is `r round(mean(data$Q46.1, na.rm = TRUE))` hours.

When asked to compare thier home's access to electricity to other households in the community `r round(mean(data$Q56 == "Worse access to electricity than most households", na.rm = TRUE)*100)`% said they had a home with worse access to electricity than most households, `r round(mean(data$Q56 == "About the same access to electricity as most households", na.rm = TRUE)*100)`% said they had a home with about the same access to electricity as most households, and `r round(mean(data$Q56 == "Better access to electricity than most households", na.rm = TRUE)*100)`% said they had a home with Better access to electricity than most households.

```{r message=FALSE, warning=FALSE, fig.height=3,fig.width=8}
plot1 <- data %>%
  filter(!is.na(Q43b)) %>%
ggplot(aes(x = as.factor(Q43b), fill = as.factor(Q43b))) +
  geom_bar(show.legend = FALSE) +
  scale_x_discrete(labels= c("1" = "appliances", "2" = "cooking", "3" = "entertainment and electronics", "4" = "heating", "5" = "lighting")) +
  labs(x= "Source" , y= "Count", title = "Electriciy Use Type") +
  scale_fill_manual(values=c("#999999", "#999999","#999999", "#999999","#999999")) +
  coord_flip()

plot2 <- ggplot(data, aes(x = Q56, fill = Q56)) +
  geom_bar(show.legend = FALSE) +
  scale_x_discrete(labels=c("Worse access to electricity than most households"=expression(atop("Worse access to electricity", "than most households")),"About the same access to electricity as most households"=expression(atop("About the same access to","electricity as most households")),"Better access to electricity than most households"=expression(atop("Better access to electricity","than most households")))) +
  scale_fill_manual(values = c("#56B4E9", "#56B4E9","#56B4E9","#56B4E9")) +
  labs(
    title = expression(atop("Community Electricity","Comparison")),
    x = "",
    y = "Count" 
  ) + coord_flip()
grid.arrange(plot1, plot2, nrow = 1, ncol = 2)
```